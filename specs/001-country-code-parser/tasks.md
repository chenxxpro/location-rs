---

description: "任务列表模板用于功能实现"
---

# 任务: 国家代码解析器库

**输入**: 设计文档来自 `/specs/001-country-code-parser/`
**前置条件**: plan.md (必需), spec.md (必需用户故事), research.md, data-model.md, contracts/

**测试**: 测试是必需的 - 遵循宪法中指定的TDD方法

**组织**: 任务按用户故事分组，以支持每个故事的独立实现和测试。

## 格式: `[ID] [P?] [Story] 描述`

- **[P]**: 可以并行运行（不同文件，无依赖关系）
- **[Story]**: 任务所属的用户故事（例如 US1, US2, US3）
- 包含精确的文件路径描述

## 路径约定

- **单项目**: `src/`, `tests/` 在仓库根目录
- 以下路径假设使用plan.md中定义的单项目结构

## 阶段 1: 设置（共享基础设施）

**目的**: 项目初始化和基本结构

- [x] T001 在 / 目录下创建Rust项目结构，包含Cargo.toml
- [x] T002 [P] 在Cargo.toml中配置依赖项：serde, anyhow, thiserror
- [x] T003 [P] 在Cargo.toml中配置开发依赖项：criterion用于基准测试
- [x] T004 [P] 创建基本项目结构：src/, tests/, resources/, examples/

---

## 阶段 2: 基础（阻塞性前置条件）

**目的**: 核心基础设施，必须在任何用户故事开始前完成

**⚠️ 关键**: 此阶段完成后才能开始用户故事工作

- [x] T005 在resources/countries.json中创建基本国家数据结构
- [x] T006 [P] 在src/error.rs中定义错误类型（ParseError枚举）
- [x] T007 [P] 在src/config.rs中创建配置加载模块
- [x] T008 在src/config.rs中定义CountryInfo数据结构
- [x] T009 在tests/目录中设置基本测试框架

**检查点**: 基础就绪 - 用户故事实现现在可以并行开始

---

## 阶段 3: 用户故事 1 - 解析包含国家代码的标题文本 (优先级: P1) 🎯 MVP

**目标**: 实现核心解析功能，能够从标题文本中提取国家代码

**独立测试**: 调用解析函数并验证返回的国家代码是否正确

### 用户故事 1 的测试（必需 - TDD方法） ⚠️

> **注意: 先编写这些测试，确保在实现前测试失败**

- [x] T010 [P] [US1] 在tests/unit/parser_tests.rs中编写基本ISO代码解析的单元测试
- [x] T011 [P] [US1] 在tests/unit/parser_tests.rs中编写中文名称解析的单元测试
- [x] T012 [P] [US1] 在tests/integration/lib_tests.rs中编写完整解析流程的集成测试

### 用户故事 1 的实现

- [x] T013 [P] [US1] 在src/parser.rs中实现基本解析器结构
- [x] T014 [P] [US1] 在src/parser.rs中实现ISO代码匹配逻辑
- [x] T015 [P] [US1] 在src/parser.rs中实现中文名称匹配逻辑
- [x] T016 [US1] 在src/lib.rs中将解析器与配置集成
- [x] T017 [US1] 为解析失败添加基本错误处理
- [x] T018 [US1] 在src/lib.rs中创建主要的parse_country_code函数，返回CountryInfo对象

**检查点**: 此时，用户故事1应该完全功能化并可独立测试

---

## 阶段 4: 用户故事 2 - 处理无法识别的国家代码 (优先级: P2)

**目标**: 实现完善的错误处理机制

**独立测试**: 提供不包含国家代码的文本并验证错误处理

### 用户故事 2 的测试（必需 - TDD方法） ⚠️

- [x] T019 [P] [US2] 在tests/unit/error_tests.rs中编写NotFound错误的单元测试
- [x] T020 [P] [US2] 在tests/unit/error_tests.rs中编写InvalidInput错误的单元测试
- [x] T021 [P] [US2] 在tests/integration/lib_tests.rs中编写错误场景的集成测试

### 用户故事 2 的实现

- [x] T022 [P] [US2] 在src/error.rs中增强错误类型，添加详细错误消息
- [x] T023 [US2] 在src/parser.rs中实现输入验证逻辑

- [x] T025 [US2] 在src/parser.rs中实现模糊匹配检测
- [x] T026 [US2] 增强主函数，添加全面的错误处理

**检查点**: 此时，用户故事1和2都应该能独立工作

---

## 阶段 5: 用户故事 3 - 支持多种国家代码格式 (优先级: P3)

**目标**: 支持更多国家代码格式和优化解析性能

**独立测试**: 提供不同格式的国家代码并验证解析结果

### 用户故事 3 的测试（必需 - TDD方法） ⚠️

- [x] T027 [P] [US3] 在tests/unit/parser_tests.rs中编写alpha-3代码解析的单元测试
- [x] T028 [P] [US3] 在tests/unit/parser_tests.rs中编写模糊匹配的单元测试
- [x] T029 [P] [US3] 在benches/parser_bench.rs中编写性能基准测试

### 用户故事 3 的实现

- [x] T030 [P] [US3] 在src/parser.rs中实现alpha-3代码支持
- [x] T031 [P] [US3] 在src/parser.rs中添加模糊匹配能力
- [x] T032 [US3] 在src/parser.rs中通过缓存优化解析性能
- [x] T033 [US3] 在src/config.rs中添加匹配行为的配置选项
- [x] T034 [US3] 在resources/countries.json中增强国家数据，添加额外格式

**检查点**: 所有用户故事现在都应该能独立功能化

---

## 阶段 6: 优化和跨领域关注点

**目的**: 影响多个用户故事的改进

- [x] T035 [P] 在README.md和src/lib.rs中更新文档，移除对isocountry的引用
- [x] T036 [P] 在所有模块中进行代码清理和重构，移除isocountry依赖
- [x] T037 [P] 在所有故事中进行性能优化
- [x] T038 [P] 在tests/unit/中为边界情况添加额外单元测试
- [x] T039 [P] 安全加固和输入清理
- [x] T040 [P] 在examples/basic_usage.rs中创建使用示例
- [x] T041 运行quickstart.md验证并在需要时更新

---

## 依赖关系和执行顺序

### 阶段依赖

- **设置（阶段1）**: 无依赖 - 可以立即开始
- **基础（阶段2）**: 依赖于设置完成 - 阻塞所有用户故事
- **用户故事（阶段3+）**: 都依赖于基础阶段完成
  - 用户故事然后可以并行进行（如果有人员）
  - 或者按优先级顺序依次进行（P1 → P2 → P3）
- **优化（最终阶段）**: 依赖于所有期望的用户故事完成

### 用户故事依赖

- **用户故事1（P1）**: 基础阶段完成后可以开始 - 不依赖其他故事
- **用户故事2（P2）**: 基础阶段完成后可以开始 - 可能与US1集成但应可独立测试
- **用户故事3（P3）**: 基础阶段完成后可以开始 - 可能与US1/US2集成但应可独立测试

### 每个用户故事内部

- 测试（必需）必须在实现前编写并失败
- 核心实现先于集成
- 故事完成后才能移动到下一个优先级

### 并行机会

- 所有标记为[P]的设置任务可以并行运行
- 所有标记为[P]的基础任务可以并行运行（在阶段2内）
- 基础阶段完成后，所有用户故事可以并行开始（如果团队容量允许）
- 用户故事的所有标记为[P]的测试可以并行运行
- 故事内标记为[P]的模型可以并行运行
- 不同的用户故事可以由不同的团队成员并行处理

---

## 并行示例: 用户故事 1

```bash
# 一起启动用户故事1的所有测试:
任务: "在tests/unit/parser_tests.rs中编写基本ISO代码解析的单元测试"
任务: "在tests/unit/parser_tests.rs中编写中文名称解析的单元测试"
任务: "在tests/integration/lib_tests.rs中编写完整解析流程的集成测试"

# 一起启动用户故事1的所有实现任务:
任务: "在src/parser.rs中实现基本解析器结构"
任务: "在src/parser.rs中实现ISO代码匹配逻辑"
任务: "在src/parser.rs中实现中文名称匹配逻辑"
```

---

## 实施策略

### MVP优先（仅用户故事1）

1. 完成阶段1: 设置
2. 完成阶段2: 基础（关键 - 阻塞所有故事）
3. 完成阶段3: 用户故事1
4. **停止并验证**: 独立测试用户故事1
5. 如果准备就绪，部署/演示

### 增量交付

1. 完成设置 + 基础 → 基础就绪
2. 添加用户故事1 → 独立测试 → 部署/演示（MVP!）
3. 添加用户故事2 → 独立测试 → 部署/演示
4. 添加用户故事3 → 独立测试 → 部署/演示
5. 每个故事都增加价值而不破坏之前的故事

### 并行团队策略

有多个开发者时：

1. 团队一起完成设置 + 基础
2. 基础完成后：
   - 开发者A: 用户故事1
   - 开发者B: 用户故事2
   - 开发者C: 用户故事3
3. 故事完成并独立集成

---

## 注意事项

- [P] 任务 = 不同文件，无依赖关系
- [Story] 标签将任务映射到特定用户故事以便追踪
- 每个用户故事应该可以独立完成和测试
- 验证测试在实现前失败（TDD方法）
- 在每个任务或逻辑组后提交
- 在任何检查点停止以独立验证故事
- 避免：模糊任务、相同文件冲突、破坏独立性的跨故事依赖